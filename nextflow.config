nextflow.enable.dsl=2

includeConfig 'params.config'

executor {
    name = "${System.env.executor}"
    queueSize = 100
    submitRateLimit = '1sec'
}

process {

	// processes get different resources depending on demand

    withLabel: process_low {
        time = { "${params.time_process_low} h" }
        memory = { "${params.memory_process_low + 1*(task.attempt-1)} GB" }
		queue = { "${params.partition_fast_short}" }
		errorStrategy = 'retry'
		maxRetries = 2
    }

    withLabel: process_medium {
        time = { "${params.time_process_medium} h" }
        memory = { "${params.memory_process_medium + 2*(task.attempt-1)} GB" }
		queue = { "${params.partition_fast_short}" }
    }

    withLabel: process_high {
        time = { "${params.time_process_high} h" }
        memory = { "${params.memory_process_high + 4*(task.attempt-1)} GB" }
		queue = { "${params.partition_slow_long}" }
    }
    
    withLabel: process_very_high {
        time = { "${params.time_process_very_high} h" }
        memory = { "${params.memory_process_very_high + 10*(task.attempt-1)} GB" }
		queue = { "${params.partition_slowest_unlimited}" }
    }
	
	// common across processes
	clusterOptions = '-P "${System.env.project_group}"'
	container = "${System.env.work_dir}/containers/gwas_cosmic_latest.sif"
}

singularity {
    enabled = true
    autoMounts = true
    runOptions = '-B "${System.env.root_dir}"'
}

trace {
    enabled = true
    overwrite = true
    file = "trace"
}

dag {
    enabled = true
    overwrite = true
}
